<%= titre_page 'Prevu Enrol' %>

<div class="wrapper wrapper-content">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-content">
					<div class="row">
						<div class="col-sm-12">
							<%= search_form_for @search, {:class => 'navbar-form-custom'} do |f| %>
								<div class="form-group" >
									<%= f.search_field :nom_or_prenom_or_numero_piece_identite_or_lieu_de_naissance_or_date_de_naissance_cont,
																		 {:class => 'form-control', :placeholder => 'Faites votre recherche ici...'} %>
								</div>
							<% end %>
						</div>
					</div>
          <%= form_tag '/adherents/carte_assurance'  do %>
              <% if current_user.user_structure_assurance? %>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="actions_bouton">
                        <%= submit_tag 'Imprimer les cartes'.html_safe, {:class => 'btn btn-primary'} %>
                        <%= link_to '<i class="fa fa-plus"></i> Ajouter'.html_safe, new_adherent_path, class: 'btn btn-primary' %>
                      </div>
                    </div>
                  </div>
              <% end %>

              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                  <tr>
                    <th>Matricule</th>
                    <th>Nom</th>
                    <th>Date de naissance</th>
                    <th>Status</th>
                    <% if current_user.user_structure_assurance? %>
                        <th>Print cards</th>
                    <% end %>
                  </tr>
                  </thead>

                  <tbody>
                  <% @adherents.each do |adherent| %>
                      <tr>
                        <td><%= link_to adherent.matricule, adherent %></td>
                        <td><%= adherent.full_name %></td>
                        <td><%= adherent.date_de_naissance %></td>
                        <td><%= afficher_status adherent.status %></td>
                        <% if current_user.user_structure_assurance? %>
                            <td>
                              <% unless adherent.souscriptions.en_cours.empty? %>
                                  <input value="<%= adherent.id %>" name="ids[]" type="checkbox">
                              <% end %>
                            </td>
                        <% end %>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
                <% paginate @adherents %>
              </div>
              </div>
          <% end %>
          </div>
    </div>

  </div>
</div>
<%= csrf_meta_tag %>

<script type="text/javascript" charset="utf-8">
    $('#print_cards').on('click', function(){
        var selected = [];
        $("input[name='ids']:checked").each(function(){
            selected.push($(this).val());
        });
        if(selected.length>0){
            $.ajax({
                url: '/adherents/carte_assurance',
                method: 'post',
                data: {'ids': selected, 'authenticity_token': $('meta[name=csrf-token]').attr('content')}
            });
        }else
            alert('Choisissez au moins un adherent');

    });
</script>